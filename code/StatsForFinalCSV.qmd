---
title: "First Stats with Final .csv"
format: html
editor: visual
---

# Setup

```{r}
rm(list = ls())
library(here)
library(multcomp)
library(tidyverse)
library(ggfortify)
library(MASS)
library(emmeans)
library(DHARMa)
library(mgcv)
library(mgcViz)
library(betareg)

covid<-read.csv(here("data","CovidbyRaceandState.csv"))
covid<-covid|>dplyr::select(c(2:11))
glimpse(covid)
```

fixing data types

```{r}
covid$Date<-ymd(covid$Date)
covid$State<-as.factor(covid$State)
covid$Race<-as.factor(covid$Race)
covid$Region<-as.factor(covid$Region)
covid$Gov_Control<-as.factor(covid$Gov_Control)
glimpse(covid)
```

# Stats

## Multiple Regression

```{r}
covid1<-covid|>
  filter(Race!="Total")
  
covid1<-covid1|>
  mutate(death_rate_1000=1000*Deaths/Population_By_Race)#creating a column for the death rate per 1000
```

```{r}
ggplot(covid1,aes(Deaths/Population_By_Race))+
  geom_histogram()
```

```{r}
multreg<-lm(1000*Deaths/Population_By_Race~Race+Region+Gov_Control,data = covid1)
autoplot(multreg)
```

```{r}
anova(multreg)
summary(multreg)
```

```{r}
tukeymult<-emmeans(multreg,pairwise~Gov_Control,adjust="tukey")
summary(tukeymult$contrasts)
tukeymult2<-emmeans(multreg,pairwise~Race,adjust="tukey")
summary(tukeymult2$contrasts)
tukeymult3<-emmeans(multreg,pairwise~Region,adjust="tukey")
summary(tukeymult3$contrasts)
```

WEird?

```{r}
summary(covid1$death_rate_1000)
```

There are zeroes, which we'll assume to be impossible, so we'll add 0.0001 to work with the model

```{r}
covid1<-covid1|>
  mutate(death_rate_1000_pos=death_rate_1000+0.0001)
```

### book

```{r}
covidna<-covid1|>
  filter(!is.na(Deaths))|>
  filter(Deaths>0)
covidna<-covidna|>
  mutate(death_rate_prop = Deaths / Population_By_Race)
covidna|>filter(death_rate_prop==0) #Checking for zeroes. All good
```

```{r}
model_beta <- betareg(death_rate_prop ~ Race * Gov_Control+Region, data = covidna)
summary(model_beta)
exp(coef(model_beta))
```

inter-group dynamics? controlled for differences in populations, but not necessarily how those populations interact?
